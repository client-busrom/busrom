# å¯¼èˆªèœå•æ¢å¤æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

å¦‚æœç”²æ–¹æŠŠå¯¼èˆªæ•°æ®å¼„ä¹±äº†ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬æ¢å¤åˆ°åˆå§‹çŠ¶æ€ã€‚

**âœ… ç”Ÿäº§ç¯å¢ƒå®‰å…¨ï¼šæ— éœ€åœæ­¢ CMS æœåŠ¡**

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ¡ˆ 1ï¼šæ¢å¤åˆ°åˆå§‹çŠ¶æ€ï¼ˆæ¨èï¼‰

è¿™ä¸ªæ–¹æ¡ˆä¼šï¼š
1. è‡ªåŠ¨å¤‡ä»½å½“å‰å¯¼èˆªæ•°æ®
2. åˆ é™¤æ‰€æœ‰å¯¼èˆªèœå•
3. é‡æ–°åˆ›å»ºåˆå§‹å¯¼èˆªæ•°æ®

```bash
cd /Users/cerfbaleine/workspace/busrom-work/cms
npx tsx scripts/backup-and-reset-navigation.ts
```

**è¯´æ˜ï¼š**
- âœ… ä¸éœ€è¦åœæ­¢ CMS
- âœ… è‡ªåŠ¨åˆ›å»ºå¤‡ä»½æ–‡ä»¶
- â±ï¸ æ•´ä¸ªè¿‡ç¨‹åªéœ€è¦ 5-10 ç§’
- ğŸ“Œ åœ¨è¿™ 5-10 ç§’å†…ï¼Œå‰ç«¯ç”¨æˆ·å¯èƒ½çœ‹åˆ°ç©ºç™½å¯¼èˆªèœå•
- ğŸ“Œ æ‰§è¡Œåç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯

---

### æ–¹æ¡ˆ 2ï¼šåªä¿®å¤æ’åºï¼ˆä¸åˆ é™¤æ•°æ®ï¼‰

å¦‚æœåªæ˜¯æ’åºä¹±äº†ï¼Œä½†æ•°æ®æœ¬èº«æ²¡é—®é¢˜ï¼Œå¯ä»¥åªé‡ç½® order å€¼ï¼š

```bash
cd /Users/cerfbaleine/workspace/busrom-work/cms
npx tsx scripts/reset-navigation-order.ts
```

**è¯´æ˜ï¼š**
- âœ… ä¸åˆ é™¤ä»»ä½•æ•°æ®
- âœ… åªä¿®æ”¹ order å­—æ®µ
- â±ï¸ 1-2 ç§’å®Œæˆ
- ğŸ“Œ ç”¨æˆ·ä½“éªŒæ— å½±å“

---

### æ–¹æ¡ˆ 3ï¼šä»å¤‡ä»½æ¢å¤

å¦‚æœæ‰§è¡Œäº†æ–¹æ¡ˆ 1ï¼Œä½†å‘ç°æ¢å¤é”™äº†ï¼Œå¯ä»¥ä»å¤‡ä»½æ–‡ä»¶æ¢å¤ï¼š

```bash
# 1. æŸ¥çœ‹å¯ç”¨çš„å¤‡ä»½æ–‡ä»¶
ls -la backups/

# 2. ä»æŒ‡å®šå¤‡ä»½æ¢å¤
npx tsx scripts/restore-navigation-backup.ts backups/navigation-backup-2025-01-05T10-30-00-000Z.json
```

---

## ğŸ“ æ–‡ä»¶è¯´æ˜

### è„šæœ¬æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” | æ˜¯å¦åˆ é™¤æ•°æ® |
|------|------|-------------|
| `backup-and-reset-navigation.ts` | å¤‡ä»½å¹¶æ¢å¤åˆå§‹æ•°æ® | âœ… æ˜¯ |
| `reset-navigation-order.ts` | åªä¿®å¤æ’åº | âŒ å¦ |
| `restore-navigation-backup.ts` | ä»å¤‡ä»½æ¢å¤ | âœ… æ˜¯ |

### å¤‡ä»½æ–‡ä»¶ä½ç½®

å¤‡ä»½æ–‡ä»¶ä¿å­˜åœ¨ `cms/backups/` ç›®å½•ï¼š

```
cms/
â”œâ”€â”€ backups/
â”‚   â”œâ”€â”€ navigation-backup-2025-01-05T10-30-00-000Z.json
â”‚   â”œâ”€â”€ navigation-backup-2025-01-06T14-20-00-000Z.json
â”‚   â””â”€â”€ ...
â””â”€â”€ scripts/
    â”œâ”€â”€ backup-and-reset-navigation.ts
    â”œâ”€â”€ reset-navigation-order.ts
    â””â”€â”€ restore-navigation-backup.ts
```

---

## âš ï¸ ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹

### 1. ä¸ºä»€ä¹ˆä¸éœ€è¦åœæ­¢ CMSï¼Ÿ

- **æ•°æ®åº“æ“ä½œæ˜¯åŸå­çš„**ï¼šåˆ é™¤å’Œåˆ›å»ºæ˜¯ç¬é—´å®Œæˆçš„
- **å‰ç«¯å®æ—¶æŸ¥è¯¢**ï¼šä¿®æ”¹åç«‹å³ç”Ÿæ•ˆ
- **ä¸ä¼šå¯¼è‡´å´©æºƒ**ï¼šæœ€å¤šçŸ­æš‚æ˜¾ç¤ºç©ºç™½å¯¼èˆªï¼ˆ5-10ç§’ï¼‰

### 2. æœ€ä½³æ‰§è¡Œæ—¶é—´

è™½ç„¶ä¸éœ€è¦åœæœºï¼Œä½†å»ºè®®åœ¨**ä½æµé‡æ—¶æ®µ**æ‰§è¡Œï¼š
- å‡Œæ™¨ 2:00-5:00
- æˆ–å…¶ä»–è®¿é—®é‡æœ€å°‘çš„æ—¶æ®µ

### 3. æ‰§è¡Œå‰ç¡®è®¤

```bash
# 1. ç¡®è®¤æ•°æ®åº“è¿æ¥æ­£å¸¸
npx prisma db pull

# 2. æ£€æŸ¥å½“å‰å¯¼èˆªæ•°æ®
curl -s http://localhost:3000/api/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"query { navigationMenus { id slug order } }"}' | python3 -m json.tool
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: "Prisma client not initialized"

```bash
# è§£å†³æ–¹æ¡ˆï¼šé‡æ–°ç”Ÿæˆ Prisma client
cd /Users/cerfbaleine/workspace/busrom-work
npx prisma generate --schema=./cms/schema.prisma
```

### é—®é¢˜ 2: "Permission denied"

```bash
# è§£å†³æ–¹æ¡ˆï¼šç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x scripts/*.ts
```

### é—®é¢˜ 3: æ¢å¤åå‰ç«¯è¿˜æ˜¯æ˜¾ç¤ºæ—§æ•°æ®

**åŸå› **ï¼šæµè§ˆå™¨ç¼“å­˜æˆ– CDN ç¼“å­˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
2. ç¡¬åˆ·æ–°ï¼ˆCmd+Shift+R / Ctrl+Shift+Rï¼‰
3. å¦‚æœä½¿ç”¨äº† CDNï¼Œæ¸…é™¤ CDN ç¼“å­˜

---

## ğŸ“ ç´§æ€¥è”ç³»

å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒé‡åˆ°é—®é¢˜ï¼š

1. **ç«‹å³å›æ»š**ï¼šä»æœ€æ–°å¤‡ä»½æ¢å¤
   ```bash
   npx tsx scripts/restore-navigation-backup.ts backups/navigation-backup-LATEST.json
   ```

2. **æ£€æŸ¥æ—¥å¿—**ï¼š
   ```bash
   # CMS logs
   pm2 logs cms

   # Database logs
   docker logs busrom-postgres
   ```

3. **è”ç³»å¼€å‘å›¢é˜Ÿ**

---

## ğŸ“ è¡¥å……è¯´æ˜

### ä¸ºä»€ä¹ˆè¦å¤‡ä»½ï¼Ÿ

è™½ç„¶å¯ä»¥é‡æ–°ç”Ÿæˆåˆå§‹æ•°æ®ï¼Œä½†å¤‡ä»½å¯ä»¥ï¼š
- ä¿ç•™ç”²æ–¹çš„è‡ªå®šä¹‰ä¿®æ”¹
- å¿«é€Ÿå›æ»šåˆ°ä»»æ„æ—¶é—´ç‚¹
- ä½œä¸ºæ•°æ®å®¡è®¡è®°å½•

### å¤‡ä»½ä¿ç•™ç­–ç•¥

å»ºè®®å®šæœŸæ¸…ç†æ—§å¤‡ä»½ï¼š

```bash
# ä¿ç•™æœ€è¿‘ 30 å¤©çš„å¤‡ä»½
find backups/ -name "navigation-backup-*.json" -mtime +30 -delete
```

æˆ–è€…è®¾ç½®å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ¸…ç†ã€‚
