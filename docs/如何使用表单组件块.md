# 如何使用表单组件块（Form Block）

## 概述

表单组件块（Form Block）是一个可复用的组件，像复用组件块一样简单。运营人员只需选择一个表单配置（FormConfig），就可以在任何页面中插入完整的表单。

## 核心理念

**超级简单**：就像使用 Reusable Block 一样，选一个 FormConfig，完事！

- 📋 选择 FormConfig → 自动渲染完整表单
- 🎯 所有配置在 FormConfig 中 → 一次配置，到处使用
- 🔄 修改 FormConfig → 所有使用的地方自动更新

## 使用步骤

### 1. 创建表单配置（FormConfig）

在 CMS 后台创建表单配置：

1. 进入 **Form Configs** 页面
2. 点击 **Create Form Config**
3. 填写表单信息：
   - **Name**: 表单名称（例如："产品咨询表单"）
   - **Form Type**: 表单类型（例如："CONTACT"）
   - **Target Entity**: 目标实体（可选）
   - **Target Entity ID**: 目标实体ID（可选）
4. 添加表单字段：
   ```
   字段 1: name → "Your Name" (必填)
   字段 2: email → "Email Address" (必填)
   字段 3: whatsapp → "WhatsApp" (可选)
   字段 4: message → "Message" (必填)
   ```
5. 保存

### 2. 插入表单块

在任何页面（Product, ProductSeries, Blog, Application 等）：

1. 打开文档编辑器
2. 点击 **"+"** 按钮
3. 选择 **"📋 Form Block"**
4. 选择刚创建的 FormConfig
5. 完成！

就这么简单！不需要配置其他任何东西。

## 使用场景

### 场景 1：产品页面咨询表单

```
1. 创建 FormConfig: "Product Inquiry Form"
2. 在产品详情页底部插入 Form Block
3. 选择 "Product Inquiry Form"
4. 保存
```

### 场景 2：博客订阅表单

```
1. 创建 FormConfig: "Newsletter Subscription"
2. 在博客文章中插入 Form Block
3. 选择 "Newsletter Subscription"
4. 保存
```

### 场景 3：通用联系表单

```
1. 创建 FormConfig: "General Contact Form"
2. 在任何需要的页面插入 Form Block
3. 选择 "General Contact Form"
4. 保存
```

## FormConfig 的优势

### ✅ 复用性

创建一次，到处使用：

```
FormConfig: "产品咨询表单"
├── 用在 Product A
├── 用在 Product B
├── 用在 ProductSeries X
└── 用在 Application Y
```

### ✅ 统一管理

修改一次，全部更新：

```
修改 FormConfig 的字段顺序
→ 所有使用这个配置的页面自动更新
```

### ✅ 灵活配置

不同的表单用不同的 FormConfig：

```
- 产品咨询表单: name, email, whatsapp, message
- 简单订阅表单: email
- 完整联系表单: name, email, company, phone, message
```

## 前端自动功能

### 自动追踪来源

表单会自动记录：
- 来源页面类型（Product, Blog, etc.）
- 来源实体 ID
- 用户语言
- 如果是产品页面，自动关联 `relatedProduct`

### 自动发送邮件

提交后自动：
- 发送通知邮件给管理员
- 发送自动回复给客户
- 更新 `emailSent` 状态

### 自动表单验证

- 必填字段验证
- 邮箱格式验证
- 显示成功/错误消息

## 技术细节

### CMS 组件块

**文件**: `cms/component-blocks/components/form-block.tsx`

```typescript
// 只有一个字段：formConfig（关联 FormConfig）
schema: {
  formConfig: fields.relationship({
    label: 'Select Form Configuration',
    listKey: 'FormConfig',
  })
}
```

### 前端组件

**文件**: `web/app/components/ContactFormBlock.tsx`

```typescript
// 只需要 formConfig，其他都自动处理
<ContactFormBlock formConfig={formConfig} />
```

### 渲染器

**文件**: `web/app/components/document-renderer/renderers.tsx`

```typescript
// 超级简单的渲染
formBlock: (props) => {
  return <ContactFormBlock formConfig={props.formConfig} />
}
```

## 与 Reusable Block 的对比

| 特性 | Reusable Block | Form Block |
|------|----------------|------------|
| 选择方式 | 选择 ReusableBlock | 选择 FormConfig |
| 内容类型 | 富文本内容 | 表单 |
| 复用性 | ✅ 是 | ✅ 是 |
| 修改同步 | ✅ 自动 | ✅ 自动 |
| 使用难度 | 简单 | 简单 |

## 相关文件

### CMS (后端)
- `cms/component-blocks/components/form-block.tsx` - 组件块定义
- `cms/component-blocks/index.ts` - 组件块注册
- `cms/schemas/FormConfig.ts` - 表单配置模型
- `cms/schemas/ContactForm.ts` - 表单提交模型

### Web (前端)
- `web/app/components/ContactFormBlock.tsx` - 表单组件
- `web/app/components/document-renderer/renderers.tsx` - 渲染器
- `web/app/api/contact-form/route.ts` - API 路由（如果存在）

## 总结

Form Block 的设计原则就是**简单**：

1. **运营侧**：选 FormConfig → 插入 → 完成
2. **配置侧**：创建 FormConfig → 定义字段 → 保存
3. **前端侧**：自动渲染 → 自动提交 → 自动追踪

**就像使用 Reusable Block 一样简单！** 🎉
