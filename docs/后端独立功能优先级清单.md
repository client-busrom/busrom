# 后端独立功能优先级清单

**文档版本**: v1.0
**创建日期**: 2025-11-05

---

## 📊 功能分类总览

根据前后端依赖关系,当前所有功能可以分为三类:

| 类型 | 说明 | 数量 | 是否阻塞 |
|------|------|------|----------|
| **🟢 后端独立** | 可以在 CMS 内完成,不依赖前端 | 5 个 | ❌ 不阻塞 |
| **🟡 后端为主** | 后端先实现,前端简单调用 | 3 个 | ⚠️ 部分阻塞 |
| **🔴 前后端强依赖** | 必须前后端同步开发 | 7 个 | ✅ 阻塞 |

---

## 🟢 后端独立功能 (可立即开发)

这些功能可以在 CMS 后台独立完成,**不需要等待前端开发**:

### 1. ✅ IndexNow 协议实现 (推荐优先)

**优先级**: 🔴 高
**工作量**: 1-2 小时
**依赖前端**: ❌ 否

**说明**:
- 在 CMS 内实现自动提交到搜索引擎
- 需要前端配合的只是一个验证文件 (`/indexnow-{key}.txt`)
- **即使前端没完成,CMS 功能也能独立工作**

**立即可做**:
1. ✅ 创建 `cms/lib/indexnow.ts` - 提交函数
2. ✅ 在各个模型 hooks 中集成
3. ✅ 测试提交功能 (查看日志即可)
4. ⏳ 前端验证文件可以稍后添加

**收益**:
- ✅ 内容发布后立即通知 Bing/Yandex
- ✅ 加快搜索引擎索引速度
- ✅ 无需前端就能验证功能

**详细指南**: `docs/IndexNow实现指南.md`

---

### 2. ✅ 邮件功能优化和测试

**优先级**: 🟡 中
**工作量**: 2-3 小时
**依赖前端**: ❌ 否

**说明**:
- 邮件发送功能已实现,但可以优化
- 完全在 CMS 后台独立工作

**可以做**:
1. ✅ 添加邮件发送队列 (避免阻塞)
2. ✅ 优化邮件模板 (更好的样式)
3. ✅ 添加邮件发送日志记录
4. ✅ 实现邮件重试机制
5. ✅ 在 CMS 中添加"测试邮件"功能按钮

**测试方法**:
- 在 CMS 中创建测试联系表单
- 检查是否收到邮件
- 查看 emailSent 标记

---

### 3. ✅ 导航菜单拖拽排序功能

**优先级**: 🟡 中
**工作量**: 2-3 小时
**依赖前端**: ❌ 否 (仅 CMS 后台)

**说明**:
- 在 CMS Admin UI 中添加拖拽排序
- **不影响前端**,前端只需读取 order 字段

**需要做**:
1. ❌ 创建 `admin/pages/navigation-manager.tsx`
2. ❌ 安装拖拽库 (`@dnd-kit/*` - 已安装)
3. ❌ 实现拖拽排序逻辑
4. ❌ 在 Keystone 配置中注册自定义页面

**收益**:
- ✅ 运营人员可以通过拖拽调整菜单顺序
- ✅ 前端读取 order 字段即可(无需特殊处理)

**参考**: `docs/03-CMS后台功能.md` 第 306-347 行

---

### 4. ✅ 图片变体管理优化

**优先级**: 🟢 低
**工作量**: 1-2 小时
**依赖前端**: ❌ 否

**说明**:
- 图片优化功能已实现
- 可以添加批量重新生成功能

**可以做**:
1. ✅ 添加"重新生成变体"按钮
2. ✅ 添加批量操作功能
3. ✅ 优化 variants 显示界面 (已有基础)
4. ✅ 添加变体删除功能

**测试**:
- 上传图片,查看是否生成变体
- 查看 S3/MinIO 中的文件

---

### 5. ✅ CMS 用户权限管理

**优先级**: 🟡 中
**工作量**: 3-4 小时
**依赖前端**: ❌ 否

**说明**:
- 当前所有用户都是管理员
- 可以添加角色和权限控制

**可以做**:
1. ❌ 创建 Role 模型 (超级管理员、编辑、审核)
2. ❌ 在 User 模型中添加 role 字段
3. ❌ 配置各模型的访问控制
4. ❌ 限制某些字段只有管理员可见

**收益**:
- ✅ 多人协作更安全
- ✅ 防止误操作

---

## 🟡 后端为主功能 (需要前端简单配合)

这些功能主要在后端实现,前端只需简单调用:

### 6. ⚠️ Sitemap 优化

**优先级**: 🟡 中
**工作量**: 1-2 小时
**依赖前端**: ⚠️ 需要前端配合(路由文件)

**说明**:
- Sitemap 生成逻辑在后端
- 前端只需提供路由文件

**后端可以做**:
1. ✅ 优化 GraphQL 查询性能
2. ✅ 添加 Sitemap 缓存
3. ✅ 实现 Sitemap 索引 (如果 URL > 50,000)
4. ✅ 添加多语言 Sitemap

**前端需要配合**:
1. ⏳ 保持 `/sitemap.xml` 路由
2. ⏳ 如果添加新页面类型,需要更新 sitemap 逻辑

**当前状态**: ✅ 基础功能已完成,可以优化

---

### 7. ⚠️ 缓存管理系统

**优先级**: 🟡 中
**工作量**: 2-3 小时
**依赖前端**: ⚠️ 部分依赖

**说明**:
- 在 CMS 配置更新后清除缓存
- 主要在后端实现

**后端可以做**:
1. ❌ 创建 `cms/lib/cache.ts`
2. ❌ 实现 Redis 或内存缓存
3. ❌ 在 SiteConfig hooks 中清除缓存
4. ❌ 在 CustomScript hooks 中清除缓存

**前端需要配合**:
1. ⏳ 前端 API 调用添加缓存策略
2. ⏳ 响应缓存清除信号

**收益**:
- ✅ 配置修改立即生效
- ✅ 提升性能

---

### 8. ⚠️ API 性能优化

**优先级**: 🟢 低
**工作量**: 2-4 小时
**依赖前端**: ❌ 否

**说明**:
- 优化 GraphQL 查询
- 添加数据库索引

**后端可以做**:
1. ✅ 添加数据库索引 (sku, slug, status)
2. ✅ 优化 GraphQL 查询 (减少 N+1 查询)
3. ✅ 添加查询缓存
4. ✅ 实现分页优化

**测试**:
- 使用 GraphQL Playground 测试查询速度
- 查看数据库查询日志

---

## 🔴 前后端强依赖功能 (需要同步开发)

这些功能**必须等待前端开发**,或需要前后端密切配合:

### 9. ❌ Meta 标签和 SEO

**优先级**: 🔴 高
**工作量**: 前端 4-5 小时 + 后端 1 小时
**依赖前端**: ✅ 强依赖

**说明**:
- CMS 配置已完成 ✅
- **必须等前端实现 metadata 渲染**

**阻塞原因**:
- Meta 标签需要在前端页面的 `<head>` 中渲染
- 需要前端调用 CMS API 获取数据

---

### 10. ❌ Open Graph 和结构化数据

**优先级**: 🔴 高
**工作量**: 前端 3-4 小时
**依赖前端**: ✅ 强依赖

**说明**:
- 需要在前端 HTML 中插入标签
- 完全依赖前端实现

---

### 11. ❌ 多语言 hreflang 标签

**优先级**: 🔴 高
**工作量**: 前端 2-3 小时
**依赖前端**: ✅ 强依赖

**说明**:
- 前端路由已支持多语言
- 需要在前端 metadata 中添加 alternates

---

### 12. ❌ 自定义代码注入 (CustomScript)

**优先级**: 🔴 高
**工作量**: 前端 4-5 小时 + 后端 1 小时
**依赖前端**: ✅ 强依赖

**说明**:
- CMS 配置完整 ✅
- **必须等前端实现脚本注入组件**

**阻塞原因**:
- 需要在前端 layout 中读取 CMS 数据
- 需要根据页面类型匹配脚本
- 需要插入到正确位置 (header/footer)

---

### 13-15. ❌ 其他前端功能

- 图片 alt 属性使用
- 性能优化 (压缩、缓存头)
- 前端页面开发

**全部依赖前端**

---

## 📋 优先级建议

### 🔴 立即可做 (后端独立,高优先级)

**推荐顺序**:

1. **IndexNow 协议** (1-2 小时) ⭐⭐⭐
   - 立即提升 SEO 效果
   - 完全独立,不依赖前端
   - 收益高,实现简单

2. **导航菜单拖拽排序** (2-3 小时) ⭐⭐
   - 提升运营体验
   - CMS 后台功能
   - 前端无感知

3. **邮件功能优化** (2-3 小时) ⭐⭐
   - 提升可靠性
   - 添加监控和日志
   - 独立功能

**总工作量**: 5-8 小时
**可以并行**: 可以同时开发,互不影响

---

### 🟡 中期可做 (后端为主)

4. **缓存管理系统** (2-3 小时)
5. **Sitemap 优化** (1-2 小时)
6. **用户权限管理** (3-4 小时)
7. **API 性能优化** (2-4 小时)

**总工作量**: 8-13 小时

---

### ⏳ 需要等待前端

8. Meta 标签和 SEO
9. Open Graph 标签
10. hreflang 标签
11. 自定义代码注入
12. 图片 alt 属性
13. 前端页面开发

**这些功能必须等前端框架搭建完成**

---

## 💡 开发策略建议

### 方案 1: 后端优先 (推荐)

**适合**: 前端还需要时间

**时间表**:
- **第 1 周**: 实现 3 个后端独立功能
  - IndexNow 协议 ✅
  - 导航菜单拖拽 ✅
  - 邮件优化 ✅

- **第 2 周**: 实现后端为主功能
  - 缓存系统 ✅
  - Sitemap 优化 ✅
  - 权限管理 ✅

- **第 3 周**: 前后端同步开发
  - 前端开始开发页面
  - 后端配合前端需求
  - 集成 SEO 和代码注入

---

### 方案 2: 并行开发

**适合**: 前端已经开始

**分工**:
- **后端工程师**:
  - 立即开始 IndexNow、导航拖拽、邮件优化
  - 为前端准备好 API 文档

- **前端工程师**:
  - 开发页面框架
  - 实现 Meta 标签渲染
  - 实现代码注入组件

- **第 2 周汇合**:
  - 前后端联调
  - 测试集成功能

---

## ✅ 总结

### 回答你的问题:

**Q: 是不是后端的功能都需要前端同步开发?**

**A**: ❌ 不是!

- **5 个高价值功能可以立即在后端独立完成**
- **3 个功能后端为主,前端简单配合**
- **7 个功能需要前后端同步开发**

### 立即可做的高优先级后端功能:

1. ⭐⭐⭐ **IndexNow 协议** - 最推荐!
   - 工作量: 1-2 小时
   - 收益: 加快搜索引擎索引
   - 依赖: 无

2. ⭐⭐ **导航菜单拖拽排序**
   - 工作量: 2-3 小时
   - 收益: 提升运营体验
   - 依赖: 无

3. ⭐⭐ **邮件功能优化**
   - 工作量: 2-3 小时
   - 收益: 提升可靠性
   - 依赖: 无

**建议**: 先完成这 3 个功能,然后根据前端进度决定下一步!

---

**文档维护**: AI Assistant
**最后更新**: 2025-11-05
