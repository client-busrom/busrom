# å¯¼èˆªèœå• - å¿«é€Ÿå‚è€ƒ

## ğŸ“‹ æ ¸å¿ƒæ¦‚å¿µ

### NavigationMenu æ¨¡å‹
- **ä¸å­˜å‚¨å›¾ç‰‡** - åªå­˜å‚¨èœå•ç»“æ„
- **Shop å­èœå•** - é“¾æ¥æ ¼å¼: `/shop?series={slug}`
- **Product å­èœå•** - é“¾æ¥æ ¼å¼: `/product/{slug}`

### å›¾ç‰‡è·å–æ–¹å¼
- **è‡ªåŠ¨** - ä» ProductSeries çš„ç¬¬ä¸€ä¸ªäº§å“ä¸­è·å–
- **æ‰‹åŠ¨è¦†ç›–** - å¯åœ¨ CMS ä¸­ä¸ºèœå•é¡¹æ‰‹åŠ¨é€‰æ‹©å›¾ç‰‡
- **ä¼˜å…ˆçº§** - æ‰‹åŠ¨ > è‡ªåŠ¨ > æ— å›¾ç‰‡

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç”Ÿæˆå¯¼èˆªèœå•æ•°æ®ï¼ˆCMSï¼‰

```bash
cd cms
npm run seed:navigation
```

**ç”Ÿæˆç»“æœ**:
- 6 ä¸ªé¡¶çº§èœå•
- 25 ä¸ªå­èœå•
- 31 ä¸ªèœå•é¡¹æ€»è®¡

### 2. å‰ç«¯è·å–å¸¦å›¾ç‰‡çš„å¯¼èˆªæ•°æ®

```typescript
import { enrichNavigationWithImages } from '@/lib/navigation/enrichNavigationWithImages'

// è·å–æ•°æ®
const menus = await getNavigationMenus()
const series = await getProductSeries()

// åˆå¹¶å›¾ç‰‡
const enrichedMenus = enrichNavigationWithImages(menus, series)
```

### 3. æ¸²æŸ“å¯¼èˆªèœå•

```tsx
<nav>
  {enrichedMenus.map(menu => (
    <MenuItem key={menu.id} menu={menu} />
  ))}
</nav>
```

---

## ğŸ“Š æ•°æ®ç»“æ„

### NavigationMenu

```typescript
{
  id: string
  name: {
    en: 'Shop',
    'zh-CN': 'å•†åº—',
    // ... 24 languages
  }
  type: 'STANDARD' | 'PRODUCT_CARDS' | 'SUBMENU'
  link: '/shop'
  order: 3
  isSystem: true
  visible: true
  children: [
    {
      id: string
      name: { en: 'Glass Standoff', ... }
      type: 'PRODUCT_CARDS'
      link: '/shop?series=glass-standoff'
      order: 1
      image: null  // è‡ªåŠ¨å¡«å……
    }
  ]
}
```

### ProductSeries

```typescript
{
  id: string
  slug: 'glass-standoff'
  name: { en: 'Glass Standoff', ... }
  products: [
    {
      coverImage: {
        url: '/uploads/image.jpg'
        alt: 'Glass Standoff'
      }
    }
  ]
}
```

---

## ğŸ¯ ä¸‰ç§èœå•ç±»å‹

### 1. STANDARD (æ™®é€šä¸‹æ‹‰)
- ç”¨äº: Service, Contact Us
- å­èœå•: ç®€å•åˆ—è¡¨
- å›¾ç‰‡: ä¸éœ€è¦

```
Service â–¼
  â”œâ”€ Service Overview
  â”œâ”€ One-stop Shop
  â”œâ”€ FAQ
  â””â”€ Application
```

### 2. PRODUCT_CARDS (å›¾æ–‡å¡ç‰‡)
- ç”¨äº: Shop, Product
- å­èœå•: 4åˆ—ç½‘æ ¼å¡ç‰‡
- å›¾ç‰‡: è‡ªåŠ¨è·å–

```
Shop â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ–¼ï¸    â”‚ ğŸ–¼ï¸    â”‚ ğŸ–¼ï¸    â”‚ ğŸ–¼ï¸    â”‚
  â”‚ Glass â”‚ Glass â”‚ Glass â”‚ Glass â”‚
  â”‚ Stand â”‚ Fitti â”‚ Fence â”‚ Clip  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. SUBMENU (å›¾æ ‡èœå•)
- ç”¨äº: About Us
- å­èœå•: å›¾æ ‡+æ–‡å­—
- å›¾ç‰‡: ä¸éœ€è¦

```
About Us â–¼
  â”œâ”€ ğŸ“– Our Story
  â”œâ”€ âœï¸ Blog
  â”œâ”€ ğŸ§ Support
  â”œâ”€ ğŸ›¡ï¸ Privacy Policy
  â””â”€ âš ï¸ Fraud Notice
```

---

## ğŸ”§ GraphQL æŸ¥è¯¢

### å®Œæ•´æŸ¥è¯¢

```graphql
query GetNavigationData {
  # å¯¼èˆªèœå•
  navigationMenus(
    where: { parent: null, visible: true }
    orderBy: { order: asc }
  ) {
    id
    name
    type
    icon
    link
    order
    children(
      where: { visible: true }
      orderBy: { order: asc }
    ) {
      id
      name
      type
      icon
      link
      order
      image {
        id
        url
        alt
        width
        height
      }
    }
  }

  # äº§å“ç³»åˆ—ï¼ˆç”¨äºå›¾ç‰‡ï¼‰
  productSeries(where: { isActive: true }) {
    id
    slug
    name
    products(
      where: { status: "PUBLISHED" }
      orderBy: { createdAt: desc }
      take: 1
    ) {
      coverImage {
        id
        url
        alt
        width
        height
      }
    }
  }
}
```

---

## ğŸ“ CMS æ“ä½œ

### æŸ¥çœ‹å¯¼èˆªèœå•

```
http://localhost:3000/admin/navigation-menus
```

### æ·»åŠ æ–°çš„ç³»åˆ—å­èœå•

1. è¿›å…¥ Navigation Menus
2. æ‰¾åˆ° "Shop" æˆ– "Product" èœå•
3. ç‚¹å‡»ç¼–è¾‘
4. åœ¨ "Child Menus" ä¸­æ·»åŠ :
   - Name: `{"en": "New Series"}`
   - Type: `PRODUCT_CARDS`
   - Link: `/shop?series=new-series`
   - Order: `9`
5. ä¿å­˜

**å‰ç«¯ä¼šè‡ªåŠ¨è·å–è¯¥ç³»åˆ—çš„å›¾ç‰‡** âœ…

### æ‰‹åŠ¨è®¾ç½®å›¾ç‰‡

1. ç¼–è¾‘å­èœå•é¡¹
2. åœ¨ "Card Image" å­—æ®µé€‰æ‹© Media
3. ä¿å­˜

**æ‰‹åŠ¨è®¾ç½®çš„å›¾ç‰‡ä¼šè¦†ç›–è‡ªåŠ¨è·å–çš„** âœ…

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜é…ç½®

```typescript
// Server Component
export const revalidate = 300 // 5 minutes

// API Route
fetch(url, { next: { revalidate: 300 } })

// React Query
{
  staleTime: 5 * 60 * 1000,
  cacheTime: 10 * 60 * 1000
}
```

### å‡å°‘æŸ¥è¯¢

```graphql
# åªè·å–ç¬¬ä¸€ä¸ªäº§å“
products(take: 1, where: { status: "PUBLISHED" }) {
  coverImage { url alt }
}
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: å­èœå•æ²¡æœ‰å›¾ç‰‡ï¼Ÿ

**åŸå› **:
1. ç³»åˆ—æ²¡æœ‰å·²å‘å¸ƒçš„äº§å“
2. äº§å“æ²¡æœ‰å°é¢å›¾
3. é“¾æ¥æ ¼å¼é”™è¯¯

**æ£€æŸ¥**:
```typescript
// 1. æ£€æŸ¥äº§å“ç³»åˆ—
const series = await getProductSeries()
console.log(series.filter(s => !s.products || s.products.length === 0))

// 2. æ£€æŸ¥é“¾æ¥
const slug = extractSeriesSlug(link)
console.log('Extracted slug:', slug)
```

### Q: å›¾ç‰‡æ²¡æœ‰æ›´æ–°ï¼Ÿ

**åŸå› **: ç¼“å­˜æœªè¿‡æœŸ

**è§£å†³**:
```typescript
// Next.js
await fetch('/api/revalidate?path=/api/navigation')

// React Query
queryClient.invalidateQueries(['navigation'])
```

### Q: å¦‚ä½•æ·»åŠ æ–°çš„äº§å“ç³»åˆ—ï¼Ÿ

1. **åˆ›å»º ProductSeries** (CMS)
   - æ·»åŠ è‡³å°‘ä¸€ä¸ªäº§å“
   - è®¾ç½®äº§å“å°é¢å›¾

2. **æ·»åŠ å¯¼èˆªèœå•é¡¹** (CMS)
   - åœ¨ Shop/Product ä¸‹æ·»åŠ å­èœå•
   - Link: `/shop?series={slug}`

3. **å‰ç«¯è‡ªåŠ¨æ›´æ–°** âœ…
   - ä¸‹æ¬¡è¯·æ±‚è‡ªåŠ¨è·å–å›¾ç‰‡

---

## ğŸ“š å®Œæ•´æ–‡æ¡£

- [å¯¼èˆªèœå•é…ç½®è¯´æ˜](./å¯¼èˆªèœå•é…ç½®è¯´æ˜.md) - è¯¦ç»†é…ç½®æŒ‡å—
- [å¯¼èˆªèœå•å›¾ç‰‡è·å–æ–¹æ¡ˆ](./å¯¼èˆªèœå•å›¾ç‰‡è·å–æ–¹æ¡ˆ.md) - å›¾ç‰‡æ–¹æ¡ˆè¯¦è§£
- [éƒ¨ç½²å’Œæ•°æ®åˆå§‹åŒ–æŒ‡å—](./éƒ¨ç½²å’Œæ•°æ®åˆå§‹åŒ–æŒ‡å—.md) - éƒ¨ç½²æŒ‡å—
- [æ•°æ®æ¨¡å‹ä¸æ¶æ„](./01-æ•°æ®æ¨¡å‹ä¸æ¶æ„.md) - æ•°æ®æ¨¡å‹æ–‡æ¡£

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

### åç«¯ï¼ˆCMSï¼‰
```
cms/
â”œâ”€â”€ schemas/
â”‚   â””â”€â”€ NavigationMenu.ts          # Schema å®šä¹‰
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ seed-navigation-menus.ts   # ç§å­æ•°æ®è„šæœ¬
â”‚   â””â”€â”€ deploy-setup.sh            # éƒ¨ç½²è„šæœ¬
â””â”€â”€ package.json                   # npm scripts
```

### å‰ç«¯ï¼ˆWebï¼‰
```
web/
â””â”€â”€ lib/
    â””â”€â”€ navigation/
        â”œâ”€â”€ enrichNavigationWithImages.ts       # æ ¸å¿ƒå‡½æ•°
        â”œâ”€â”€ README.md                           # ä½¿ç”¨æ–‡æ¡£
        â””â”€â”€ __tests__/
            â””â”€â”€ enrichNavigationWithImages.test.ts  # å•å…ƒæµ‹è¯•
```

---

## ğŸš€ å‘½ä»¤é€ŸæŸ¥

```bash
# ç”Ÿæˆå¯¼èˆªèœå•æ•°æ®
cd cms && npm run seed:navigation

# æ¸…ç©ºå¹¶é‡æ–°ç”Ÿæˆ
docker-compose exec -T postgres psql -U busrom -d busrom_cms -c "DELETE FROM \"NavigationMenu\";"
npm run seed:navigation

# æŸ¥çœ‹æ•°æ®
docker-compose exec -T postgres psql -U busrom -d busrom_cms -c "SELECT COUNT(*), parent IS NULL FROM \"NavigationMenu\" GROUP BY parent IS NULL;"

# è¿è¡Œæµ‹è¯•
cd web && npm test -- enrichNavigationWithImages
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-11-04
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
