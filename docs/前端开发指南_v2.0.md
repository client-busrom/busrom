# Busrom å‰ç«¯å¼€å‘æŒ‡å— v2.0

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2025-11-06
**é€‚ç”¨å¯¹è±¡**: å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ
**é˜…è¯»æ—¶é—´**: 30 åˆ†é’Ÿ

---

## âš ï¸ é‡è¦æ¶æ„å†³ç­– (2025-11-06æ›´æ–°)

### æ•°æ®è·å–ç­–ç•¥: REST APIè½¬æ¢å±‚æ–¹æ¡ˆ

**èƒŒæ™¯**: Keystone GraphQLè¿”å›çš„æ‰€æœ‰æ–‡æœ¬å­—æ®µéƒ½æ˜¯å¤šè¯­è¨€JSONæ ¼å¼ `{en: "...", zh: "...", ...}`,å›¾ç‰‡ä¹ŸåŒ…å«å¤æ‚çš„variantsç»“æ„ã€‚

**å†³ç­–**: é‡‡ç”¨**REST APIè½¬æ¢å±‚**,è€Œéç›´æ¥ä½¿ç”¨Apollo ClientæŸ¥è¯¢GraphQLã€‚

**åŸå› **:
1. âœ… **ç®€åŒ–ç»„ä»¶ä»£ç ** - ç»„ä»¶åªéœ€å¤„ç†å•è¯­è¨€å­—ç¬¦ä¸²,æ— éœ€åœ¨æ¯ä¸ªç»„ä»¶ä¸­æå–å¤šè¯­è¨€å­—æ®µ
2. âœ… **é›†ä¸­è½¬æ¢é€»è¾‘** - æ‰€æœ‰å¤šè¯­è¨€å¤„ç†å’Œå›¾ç‰‡variantsé€‰æ‹©é›†ä¸­åœ¨APIå±‚
3. âœ… **Mockæ•°æ®ä¸€è‡´** - Mockæ•°æ®å¯ä»¥ç›´æ¥æ¨¡æ‹ŸAPIå“åº”(å·²è½¬æ¢æ ¼å¼),æ— éœ€é¢å¤–å¤„ç†
4. âœ… **æ˜“äºç»´æŠ¤** - å½“Keystone schemaå˜åŒ–æ—¶,åªéœ€ä¿®æ”¹APIè½¬æ¢å±‚,ç»„ä»¶æ— éœ€æ”¹åŠ¨

**å®ç°æ–¹å¼**:
```
Reactç»„ä»¶
  â†“ fetch('/api/home?locale=en')
Next.js API Route (/app/api/home/route.ts)
  â†“ å†…éƒ¨ä½¿ç”¨Apollo ClientæŸ¥è¯¢Keystone GraphQL
  â†“ ä½¿ç”¨lib/localization.tsæå–å•è¯­è¨€æ–‡æœ¬
  â†“ ä½¿ç”¨lib/image-utils.tsé€‰æ‹©åˆé€‚çš„å›¾ç‰‡variant
  â†“ è¿”å›æ‰å¹³åŒ–ã€å•è¯­è¨€çš„JSON
ç»„ä»¶æ¥æ”¶ç®€å•æ•°æ®ç»“æ„
```

**æ•°æ®è½¬æ¢ç¤ºä¾‹**:
```typescript
// GraphQLè¿”å› (å¤æ‚çš„å¤šè¯­è¨€ç»“æ„)
{
  title: { en: "Glass Hardware", zh: "ç»ç’ƒäº”é‡‘" },
  image: {
    file: { url: "https://..." },
    variants: { small: "...", medium: "...", large: "..." },
    altText: { en: "...", zh: "..." },
    cropFocalPoint: { x: 0, y: 0 },
  }
}

// APIè½¬æ¢å (ç®€å•çš„å•è¯­è¨€ç»“æ„)
{
  title: "Glass Hardware",
  image: {
    url: "https://.../image-medium.jpg",
    altText: "Glass hardware product",
    thumbnailUrl: "https://.../image-thumb.jpg",
    cropFocalPoint: { x: 0, y: 0 },
  }
}
```

è¯¦è§: `docs/api-contracts/HomeContentApiDocumentation.md`

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
2. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
3. [é¡¹ç›®ç›®å½•ç»“æ„](#é¡¹ç›®ç›®å½•ç»“æ„)
4. [REST APIè§„èŒƒ](#rest-apiè§„èŒƒ)
5. [å›¾ç‰‡ä¼˜åŒ–å¤„ç†(é‡è¦â­)](#å›¾ç‰‡ä¼˜åŒ–å¤„ç†)
6. [å¤šè¯­è¨€å®ç°](#å¤šè¯­è¨€å®ç°)
7. [SEOæœ€ä½³å®è·µ](#seoæœ€ä½³å®è·µ)
8. [åç«¯æ¨¡å‹æ³¨æ„äº‹é¡¹](#åç«¯æ¨¡å‹æ³¨æ„äº‹é¡¹)
9. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
10. [å¸¸è§é—®é¢˜FAQ](#å¸¸è§é—®é¢˜faq)

---

## é¡¹ç›®æ¦‚è§ˆ

### é¡¹ç›®èƒŒæ™¯

Busromæ˜¯ä¸€ä¸ªå›½é™…åŒ–çš„B2Bç»ç’ƒäº”é‡‘äº§å“ç½‘ç«™,æ”¯æŒ24ç§è¯­è¨€,é¢å‘å…¨çƒå®¢æˆ·ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- âœ… å¤šè¯­è¨€æ”¯æŒ(24ç§è¯­è¨€)
- âœ… äº§å“ç³»åˆ—å±•ç¤º
- âœ… SKUäº§å“è¯¦æƒ…
- âœ… åšå®¢/æ–°é—»
- âœ… åº”ç”¨æ¡ˆä¾‹å±•ç¤º
- âœ… è”ç³»è¡¨å•
- âœ… SEOä¼˜åŒ–(å¤šè¯­è¨€sitemap, structured data)

### æ€§èƒ½ç›®æ ‡

- Lighthouse Performance > 90
- Lighthouse SEO > 95
- FCP (First Contentful Paint) < 1.8s
- LCP (Largest Contentful Paint) < 2.5s

---

## æŠ€æœ¯æ ˆ

### å‰ç«¯æ¡†æ¶

- **Next.js 15** (App Router)
- **React 19**
- **TypeScript 5.6+**

### æ ·å¼

- **Tailwind CSS 3.4+**
- âŒ **ç¦æ­¢ä½¿ç”¨**: Bootstrap, Foundationç­‰å…¶ä»–CSSæ¡†æ¶

### æ•°æ®è·å–

- **Apollo Client** (GraphQL)
- **SWR** (å¯é€‰,ç”¨äºå®¢æˆ·ç«¯æ•°æ®åˆ·æ–°)

### å›½é™…åŒ–

- **next-intl 4.4+**

### å›¾ç‰‡ä¼˜åŒ–

- **Next.js Imageç»„ä»¶** (è‡ªåŠ¨ä¼˜åŒ–)
- **åç«¯Image Variants** (6ç§å°ºå¯¸)

---

## é¡¹ç›®ç›®å½•ç»“æ„

```
busrom-work/
â”œâ”€â”€ web/                              # å‰ç«¯é¡¹ç›®æ ¹ç›®å½•
â”‚   â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ [locale]/                 # åŠ¨æ€è¯­è¨€è·¯ç”± (en, zh, es, fr, ...)
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx            # æ ¹å¸ƒå±€ (åŒ…å«Header/Footer)
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # é¦–é¡µ ğŸ 
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ product/              # äº§å“æ¨¡å— ğŸ“¦
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # äº§å“ç³»åˆ—åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [slug]/           # åŠ¨æ€è·¯ç”±: ç³»åˆ—slug
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # ç³»åˆ—è¯¦æƒ…é¡µ
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ shop/                 # å•†åº—æ¨¡å— ğŸ›’
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # SKUäº§å“åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [sku]/            # åŠ¨æ€è·¯ç”±: äº§å“SKU
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx      # äº§å“è¯¦æƒ…é¡µ
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ service/              # æœåŠ¡æ¨¡å— ğŸ› ï¸
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx          # æœåŠ¡é¦–é¡µ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ one-stop-shop/    # ä¸€ç«™å¼æœåŠ¡
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ faq/              # å¸¸è§é—®é¢˜
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ application/      # åº”ç”¨æ¡ˆä¾‹
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx      # æ¡ˆä¾‹åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ [id]/         # åŠ¨æ€è·¯ç”±: æ¡ˆä¾‹ID
â”‚   â”‚   â”‚   â”‚           â””â”€â”€ page.tsx  # æ¡ˆä¾‹è¯¦æƒ…
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ about-us/             # å…³äºæˆ‘ä»¬ â„¹ï¸
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ story/            # å“ç‰Œæ•…äº‹
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ blog/             # åšå®¢
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx      # åšå®¢åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [slug]/       # åŠ¨æ€è·¯ç”±: åšå®¢slug
â”‚   â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx  # åšå®¢è¯¦æƒ…
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ support/          # å”®åæ”¯æŒ
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ contact-us/           # è”ç³»æˆ‘ä»¬ ğŸ“§
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ privacy-policy/       # éšç§æ”¿ç­–
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ fraud-notice/         # é˜²æ¬ºè¯ˆå£°æ˜
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ sitemap.xml/              # SEO: Sitemap
â”‚   â”‚   â”‚   â””â”€â”€ route.ts              # åŠ¨æ€ç”Ÿæˆsitemap.xml
â”‚   â”‚   â”œâ”€â”€ robots.txt/               # SEO: Robots
â”‚   â”‚   â”‚   â””â”€â”€ route.ts              # åŠ¨æ€ç”Ÿæˆrobots.txt
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                      # Next.js API Routes (å¯é€‰)
â”‚   â”‚   â”‚   â””â”€â”€ ...                   # è‡ªå®šä¹‰APIç«¯ç‚¹
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout.tsx                # å…¨å±€å¸ƒå±€ (é‡å®šå‘åˆ°[locale])
â”‚   â”‚   â”œâ”€â”€ page.tsx                  # æ ¹é¡µé¢ (é‡å®šå‘åˆ°[locale])
â”‚   â”‚   â””â”€â”€ globals.css               # å…¨å±€æ ·å¼ (Tailwindå…¥å£)
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                   # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/                   # å¸ƒå±€ç»„ä»¶ ğŸ—ï¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx            # ç½‘ç«™å¤´éƒ¨ (å¯¼èˆªèœå•)
â”‚   â”‚   â”‚   â”œâ”€â”€ Footer.tsx            # ç½‘ç«™åº•éƒ¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Navigation.tsx        # å¯¼èˆªèœå• (æ”¯æŒå¤šå±‚çº§)
â”‚   â”‚   â”‚   â””â”€â”€ LanguageSwitcher.tsx  # è¯­è¨€åˆ‡æ¢å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ home/                     # é¦–é¡µä¸“ç”¨ç»„ä»¶ ğŸ 
â”‚   â”‚   â”‚   â”œâ”€â”€ HeroBanner.tsx        # 1. Heroè½®æ’­å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductSeriesCarousel.tsx  # 2. äº§å“ç³»åˆ—è½®æ’­
â”‚   â”‚   â”‚   â”œâ”€â”€ ServiceFeatures.tsx   # 3. æœåŠ¡ç‰¹ç‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ Sphere3D.tsx          # 4. 3Dçƒä½“å±•ç¤º
â”‚   â”‚   â”‚   â”œâ”€â”€ SimpleCta.tsx         # 5. ç®€å•CTA
â”‚   â”‚   â”‚   â”œâ”€â”€ SeriesIntro.tsx       # 6. ç³»åˆ—ä»‹ç»
â”‚   â”‚   â”‚   â”œâ”€â”€ FeaturedProducts.tsx  # 7. ç²¾é€‰äº§å“
â”‚   â”‚   â”‚   â”œâ”€â”€ BrandAdvantages.tsx   # 8. å“ç‰Œä¼˜åŠ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ OemOdm.tsx            # 9. OEM/ODMæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ QuoteSteps.tsx        # 10. æŠ¥ä»·æ­¥éª¤
â”‚   â”‚   â”‚   â”œâ”€â”€ MainForm.tsx          # 11. ä¸»è¡¨å•
â”‚   â”‚   â”‚   â”œâ”€â”€ WhyChooseBusrom.tsx   # 12. ä¸ºä»€ä¹ˆé€‰æ‹©
â”‚   â”‚   â”‚   â”œâ”€â”€ CaseStudies.tsx       # 13. æ¡ˆä¾‹å±•ç¤º
â”‚   â”‚   â”‚   â”œâ”€â”€ BrandAnalysis.tsx     # 14. å“ç‰Œåˆ†æ
â”‚   â”‚   â”‚   â””â”€â”€ BrandValue.tsx        # 15. å“ç‰Œä»·å€¼è§‚
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ product/                  # äº§å“ç›¸å…³ç»„ä»¶ ğŸ“¦
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductCard.tsx       # äº§å“å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductGrid.tsx       # äº§å“ç½‘æ ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductFilter.tsx     # äº§å“ç­›é€‰å™¨
â”‚   â”‚   â”‚   â””â”€â”€ ProductGallery.tsx    # äº§å“å›¾ç‰‡ç”»å»Š
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ui/                       # é€šç”¨UIç»„ä»¶ ğŸ¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx            # æŒ‰é’®
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx              # å¡ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx             # æ¨¡æ€æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ Spinner.tsx           # åŠ è½½åŠ¨ç”»
â”‚   â”‚   â”‚   â”œâ”€â”€ Pagination.tsx        # åˆ†é¡µå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Breadcrumb.tsx        # é¢åŒ…å±‘å¯¼èˆª
â”‚   â”‚   â”‚   â””â”€â”€ ...                   # å…¶ä»–é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ seo/                      # SEOç»„ä»¶ ğŸ”
â”‚   â”‚   â”‚   â”œâ”€â”€ MetaTags.tsx          # Metaæ ‡ç­¾
â”‚   â”‚   â”‚   â”œâ”€â”€ StructuredData.tsx    # ç»“æ„åŒ–æ•°æ®
â”‚   â”‚   â”‚   â””â”€â”€ Breadcrumb.tsx        # é¢åŒ…å±‘(SEO)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ forms/                    # è¡¨å•ç»„ä»¶ ğŸ“
â”‚   â”‚       â”œâ”€â”€ ContactForm.tsx       # è”ç³»è¡¨å•
â”‚   â”‚       â”œâ”€â”€ NewsletterForm.tsx    # é‚®ä»¶è®¢é˜…è¡¨å•
â”‚   â”‚       â””â”€â”€ FormField.tsx         # è¡¨å•å­—æ®µç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                          # å·¥å…·å‡½æ•°å’Œé…ç½® ğŸ› ï¸
â”‚   â”‚   â”œâ”€â”€ keystone-client.ts        # GraphQLå®¢æˆ·ç«¯ (Apollo Client)
â”‚   â”‚   â”œâ”€â”€ localization.ts           # å¤šè¯­è¨€å·¥å…·å‡½æ•° â­é‡è¦
â”‚   â”‚   â”œâ”€â”€ image-utils.ts            # å›¾ç‰‡å·¥å…·å‡½æ•° â­é‡è¦
â”‚   â”‚   â”œâ”€â”€ seo-utils.ts              # SEOå·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ api/                      # APIç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ sitemap.ts            # Sitemapç”Ÿæˆ
â”‚   â”‚   â”‚   â””â”€â”€ queries.ts            # GraphQLæŸ¥è¯¢å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ navigation/               # å¯¼èˆªç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ enrichNavigationWithImages.ts  # å¯¼èˆªå›¾ç‰‡å¢å¼º
â”‚   â”‚   â””â”€â”€ utils.ts                  # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ public/                       # é™æ€èµ„æº ğŸ“
â”‚   â”‚   â”œâ”€â”€ images/                   # å›¾ç‰‡èµ„æº
â”‚   â”‚   â”‚   â”œâ”€â”€ logo.svg              # Logo
â”‚   â”‚   â”‚   â”œâ”€â”€ placeholder.jpg       # å ä½å›¾
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ icons/                    # å›¾æ ‡
â”‚   â”‚   â””â”€â”€ fonts/                    # å­—ä½“(å¦‚æœéœ€è¦)
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                       # æ ·å¼æ–‡ä»¶ ğŸ¨
â”‚   â”‚   â””â”€â”€ globals.css               # å…¨å±€æ ·å¼ (Tailwindé…ç½®)
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                        # TypeScriptç±»å‹å®šä¹‰ ğŸ“
â”‚   â”‚   â”œâ”€â”€ api.ts                    # APIå“åº”ç±»å‹
â”‚   â”‚   â”œâ”€â”€ models.ts                 # æ•°æ®æ¨¡å‹ç±»å‹
â”‚   â”‚   â””â”€â”€ common.ts                 # é€šç”¨ç±»å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware.ts                 # Next.jsä¸­é—´ä»¶ (i18nè·¯ç”±) ğŸŒ
â”‚   â”œâ”€â”€ i18n.config.ts                # i18né…ç½®
â”‚   â”œâ”€â”€ next.config.js                # Next.jsé…ç½®
â”‚   â”œâ”€â”€ tailwind.config.ts            # Tailwindé…ç½®
â”‚   â”œâ”€â”€ tsconfig.json                 # TypeScripté…ç½®
â”‚   â”œâ”€â”€ package.json                  # ä¾èµ–ç®¡ç†
â”‚   â””â”€â”€ .env.local                    # ç¯å¢ƒå˜é‡
â”‚
â”œâ”€â”€ cms/                              # åç«¯CMS (Keystone)
â”‚   â””â”€â”€ ... (åç«¯ä»£ç )
â”‚
â””â”€â”€ docs/                             # é¡¹ç›®æ–‡æ¡£ ğŸ“š
    â”œâ”€â”€ å‰ç«¯å¼€å‘æŒ‡å—_v2.0.md           # æœ¬æ–‡æ¡£
    â”œâ”€â”€ GraphQL_APIå®Œæ•´æ–‡æ¡£.md         # APIæ–‡æ¡£
    â”œâ”€â”€ GraphQLæŸ¥è¯¢ç¤ºä¾‹é›†åˆ.graphql     # æŸ¥è¯¢ç¤ºä¾‹
    â””â”€â”€ APIç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆ.md             # ç‰ˆæœ¬æ§åˆ¶
```

### ç›®å½•è¯´æ˜

#### å…³é”®ç›®å½•

- **`app/[locale]/`**: æ‰€æœ‰é¡µé¢éƒ½åœ¨è¯­è¨€è·¯ç”±ä¸‹,å®ç°å¤šè¯­è¨€URL
- **`components/home/`**: é¦–é¡µåŒ…å«16ä¸ªç‹¬ç«‹åŒºå—ç»„ä»¶
- **`lib/`**: åŒ…å«æ ¸å¿ƒå·¥å…·å‡½æ•°,ç‰¹åˆ«æ˜¯å›¾ç‰‡å¤„ç†å’Œå¤šè¯­è¨€å¤„ç†

#### å‘½åè§„èŒƒ

- **æ–‡ä»¶å**: PascalCase (å¦‚ `ProductCard.tsx`)
- **ç»„ä»¶å**: PascalCase (å¦‚ `export default function ProductCard`)
- **å·¥å…·å‡½æ•°**: camelCase (å¦‚ `getLocalizedContent`)
- **å¸¸é‡**: UPPER_SNAKE_CASE (å¦‚ `DEFAULT_LOCALE`)

---

## REST APIè§„èŒƒ

### 1. APIæ¶æ„è¯´æ˜

å‰ç«¯**ä¸ç›´æ¥**è°ƒç”¨Keystone GraphQL,è€Œæ˜¯é€šè¿‡Next.js API Routesä½œä¸ºè½¬æ¢å±‚:

```
Reactç»„ä»¶ â†’ fetch('/api/home?locale=en') â†’ Next.js API Route
                                           â†“ å†…éƒ¨æŸ¥è¯¢GraphQL
                                           â†“ è½¬æ¢å¤šè¯­è¨€å­—æ®µ
                                           â†“ å¤„ç†å›¾ç‰‡variants
                                           â†“ è¿”å›å•è¯­è¨€JSON
```

### 2. é¦–é¡µå†…å®¹API

#### è·å–å®Œæ•´é¦–é¡µå†…å®¹

```typescript
// ç»„ä»¶ä¸­è°ƒç”¨
const response = await fetch(`/api/home?locale=${locale}`)
const homeContent = await response.json()

// è¿”å›æ•°æ®ç»“æ„ (å·²è½¬æ¢ä¸ºå•è¯­è¨€)
{
  locale: "en",
  heroBanner: [
    {
      title: "Glass Standoff",
      features: ["Feature 1", "Feature 2"],
      images: [
        {
          url: "https://s3.../image.jpg",
          altText: "Glass Standoff",
          thumbnailUrl: "https://s3.../image-thumb.jpg"
        }
      ]
    }
  ],
  productSeriesCarousel: [...],
  serviceFeatures: {...},
  // ... å…¶ä»–15ä¸ªæ¨¡å—
}
```

#### APIå®ç°å‚è€ƒ (åç«¯å¼€å‘)

```typescript
// app/api/home/route.ts
import { NextRequest, NextResponse } from 'next/server'
import { keystoneClient } from '@/lib/keystone-client'
import { getLocalizedContent } from '@/lib/localization'
import { getOptimizedImageUrl, getImageAlt } from '@/lib/image-utils'

export async function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams
  const locale = searchParams.get('locale') || 'en'

  // 1. æŸ¥è¯¢GraphQL (è·å–å¤šè¯­è¨€æ•°æ®)
  const { data, errors } = await keystoneClient.query({
    query: GET_HOME_CONTENT_QUERY
  })

  if (errors) {
    return NextResponse.json({ error: 'Failed to fetch' }, { status: 500 })
  }

  // 2. è½¬æ¢ä¸ºå•è¯­è¨€æ•°æ®
  const transformedData = {
    locale,
    heroBanner: data.heroBanners.map(item => ({
      title: getLocalizedContent(item.title, locale),
      features: item.features.map(f => getLocalizedContent(f, locale)),
      images: item.images.map(img => ({
        url: getOptimizedImageUrl(img, 'large'),
        altText: getImageAlt(img.altText, locale),
        thumbnailUrl: getOptimizedImageUrl(img, 'thumbnail')
      }))
    })),
    // ... è½¬æ¢å…¶ä»–æ¨¡å—
  }

  return NextResponse.json(transformedData)
}
```

### 3. Mockæ•°æ®å¼€å‘

åœ¨APIæœªå®ç°å‰,ä½¿ç”¨Mockæ•°æ®:

```typescript
// lib/content-data.ts
export function getMockHomeContent(locale: string = 'en'): HomeContent {
  if (locale === 'zh') {
    const { homeContent_ZH } = require('@/mock/homeContent_ZH')
    return homeContent_ZH
  }

  const { homeContent_EN } = require('@/mock/homeContent_EN')
  return homeContent_EN
}

// app/[locale]/page.tsx
const content = getMockHomeContent(locale)
}

if (!data) {
  return <EmptyState />
}
```

---

## å›¾ç‰‡ä¼˜åŒ–å¤„ç†

### â­ é‡è¦: Image Variantsè¯¦è§£

åç«¯Mediaæ¨¡å‹ä¼šè‡ªåŠ¨ä¸ºæ¯å¼ å›¾ç‰‡ç”Ÿæˆ6ç§ä¼˜åŒ–å˜ä½“:

```json
{
  "variants": {
    "thumbnail": "https://cdn.busrom.com/uploads/image-150x150.jpg",
    "small": "https://cdn.busrom.com/uploads/image-400w.jpg",
    "medium": "https://cdn.busrom.com/uploads/image-800w.jpg",
    "large": "https://cdn.busrom.com/uploads/image-1200w.jpg",
    "xlarge": "https://cdn.busrom.com/uploads/image-1920w.jpg",
    "webp": "https://cdn.busrom.com/uploads/image.webp"
  }
}
```

#### å˜ä½“å°ºå¯¸è¯´æ˜

| å˜ä½“åç§° | å°ºå¯¸ | ç”¨é€” | å…¸å‹åœºæ™¯ |
|---------|------|------|---------|
| `thumbnail` | 150x150 | ç¼©ç•¥å›¾ | åå°ç®¡ç†ã€å›¾ç‰‡é€‰æ‹©å™¨ |
| `small` | 400pxå®½ | å°å›¾ | ç§»åŠ¨ç«¯åˆ—è¡¨ã€å¡ç‰‡å°é¢ |
| `medium` | 800pxå®½ | ä¸­å›¾ | å¹³æ¿ç«¯ã€æ¡Œé¢ç«¯åˆ—è¡¨ |
| `large` | 1200pxå®½ | å¤§å›¾ | æ¡Œé¢ç«¯è¯¦æƒ…é¡µã€è½®æ’­å›¾ |
| `xlarge` | 1920pxå®½ | è¶…å¤§å›¾ | å…¨å±èƒŒæ™¯ã€Hero Banner |
| `webp` | è‡ªé€‚åº” | WebPæ ¼å¼ | æ”¯æŒWebPçš„æµè§ˆå™¨(æ–‡ä»¶æ›´å°) |

### å›¾ç‰‡URLè§£æå·¥å…·å‡½æ•°

```typescript
// lib/image-utils.ts

/**
 * Image Variantsç±»å‹å®šä¹‰
 */
export interface ImageVariants {
  thumbnail?: string
  small?: string
  medium?: string
  large?: string
  xlarge?: string
  webp?: string
}

/**
 * Mediaå¯¹è±¡ç±»å‹å®šä¹‰
 */
export interface MediaImage {
  id: string
  filename: string
  file: {
    url: string
    width?: number
    height?: number
  }
  variants?: ImageVariants
  altText?: Record<string, string> | null
}

/**
 * è·å–æœ€ä¼˜å›¾ç‰‡URL
 *
 * @param image - Mediaå¯¹è±¡
 * @param size - æœŸæœ›å°ºå¯¸
 * @param preferWebP - æ˜¯å¦ä¼˜å…ˆä½¿ç”¨WebPæ ¼å¼ (é»˜è®¤: true)
 * @returns å›¾ç‰‡URL
 */
export function getOptimizedImageUrl(
  image: MediaImage | null | undefined,
  size: 'thumbnail' | 'small' | 'medium' | 'large' | 'xlarge' = 'medium',
  preferWebP: boolean = true
): string {
  // å¦‚æœæ²¡æœ‰å›¾ç‰‡,è¿”å›å ä½å›¾
  if (!image || !image.file?.url) {
    return '/images/placeholder.jpg'
  }

  const { variants, file } = image

  // 1. ä¼˜å…ˆå°è¯•WebPæ ¼å¼(å¦‚æœæ”¯æŒä¸”å¯ç”¨)
  if (preferWebP && variants?.webp) {
    return variants.webp
  }

  // 2. å°è¯•æŒ‡å®šå°ºå¯¸çš„å˜ä½“
  if (variants && variants[size]) {
    return variants[size]!
  }

  // 3. é™çº§ç­–ç•¥: ä»å¤§åˆ°å°å°è¯•å…¶ä»–å°ºå¯¸
  const fallbackOrder: Array<keyof ImageVariants> = [
    'xlarge', 'large', 'medium', 'small', 'thumbnail'
  ]

  for (const fallbackSize of fallbackOrder) {
    if (variants && variants[fallbackSize]) {
      return variants[fallbackSize]!
    }
  }

  // 4. æœ€åè¿”å›åŸå§‹URL
  return file.url
}

/**
 * è·å–å“åº”å¼å›¾ç‰‡æºé›†
 * ç”¨äº<picture>æ ‡ç­¾æˆ–Next.js Imageçš„loader
 *
 * @param image - Mediaå¯¹è±¡
 * @returns srcsetå­—ç¬¦ä¸²
 */
export function getImageSrcSet(
  image: MediaImage | null | undefined
): string {
  if (!image || !image.variants) {
    return ''
  }

  const { variants } = image
  const srcset: string[] = []

  if (variants.small) srcset.push(`${variants.small} 400w`)
  if (variants.medium) srcset.push(`${variants.medium} 800w`)
  if (variants.large) srcset.push(`${variants.large} 1200w`)
  if (variants.xlarge) srcset.push(`${variants.xlarge} 1920w`)

  return srcset.join(', ')
}

/**
 * è·å–æœ¬åœ°åŒ–çš„altæ–‡æœ¬
 *
 * @param altText - å¤šè¯­è¨€altæ–‡æœ¬å¯¹è±¡
 * @param locale - è¯­è¨€ä»£ç 
 * @returns altæ–‡æœ¬
 */
export function getImageAlt(
  altText: Record<string, string> | null | undefined,
  locale: string
): string {
  if (!altText || typeof altText !== 'object') {
    return ''
  }

  // 1. å°è¯•è·å–æŒ‡å®šè¯­è¨€
  if (altText[locale]) {
    return altText[locale]
  }

  // 2. å›é€€åˆ°è‹±è¯­
  if (altText['en']) {
    return altText['en']
  }

  // 3. è¿”å›ç¬¬ä¸€ä¸ªå¯ç”¨å€¼
  const values = Object.values(altText)
  if (values.length > 0) {
    return values[0]
  }

  return ''
}
```

### ä½¿ç”¨ç¤ºä¾‹

#### ç¤ºä¾‹1: äº§å“å¡ç‰‡(å“åº”å¼å›¾ç‰‡)

```tsx
// components/product/ProductCard.tsx
import Image from 'next/image'
import { getOptimizedImageUrl, getImageAlt } from '@/lib/image-utils'
import { useLocale } from 'next-intl'

interface ProductCardProps {
  product: {
    name: string
    image: MediaImage
  }
}

export function ProductCard({ product }: ProductCardProps) {
  const locale = useLocale()

  // ç§»åŠ¨ç«¯ä½¿ç”¨small, æ¡Œé¢ç«¯ä½¿ç”¨medium
  const imageUrl = getOptimizedImageUrl(
    product.image,
    'medium',  // é»˜è®¤å°ºå¯¸
    true       // ä¼˜å…ˆWebP
  )

  const altText = getImageAlt(product.image.altText, locale)

  return (
    <div className="product-card">
      {/* Next.js Imageç»„ä»¶ */}
      <Image
        src={imageUrl}
        alt={altText || product.name}
        width={400}
        height={400}
        className="w-full h-auto rounded-lg"
        loading="lazy"
      />
      <h3>{product.name}</h3>
    </div>
  )
}
```

#### ç¤ºä¾‹2: Hero Banner(å…¨å±å¤§å›¾)

```tsx
// components/home/HeroBanner.tsx
import Image from 'next/image'
import { getOptimizedImageUrl, getImageAlt } from '@/lib/image-utils'

export function HeroBanner({ data, locale }: HeroBannerProps) {
  const imageUrl = getOptimizedImageUrl(
    data.backgroundImage,
    'xlarge',  // ä½¿ç”¨æœ€å¤§å°ºå¯¸
    true       // WebPä¼˜å…ˆ
  )

  const altText = getImageAlt(data.backgroundImage.altText, locale)

  return (
    <section className="relative h-screen w-full">
      <Image
        src={imageUrl}
        alt={altText}
        fill
        priority  // é¦–å±å›¾ç‰‡,ä¼˜å…ˆåŠ è½½
        className="object-cover"
        sizes="100vw"
      />
      <div className="relative z-10">
        <h1>{data.title}</h1>
      </div>
    </section>
  )
}
```

#### ç¤ºä¾‹3: å“åº”å¼å›¾ç‰‡(<picture>æ ‡ç­¾)

```tsx
// components/ui/ResponsiveImage.tsx
import { getOptimizedImageUrl, getImageAlt, getImageSrcSet } from '@/lib/image-utils'

interface ResponsiveImageProps {
  image: MediaImage
  locale: string
  className?: string
}

export function ResponsiveImage({ image, locale, className }: ResponsiveImageProps) {
  const altText = getImageAlt(image.altText, locale)

  return (
    <picture>
      {/* WebPæ ¼å¼(ç°ä»£æµè§ˆå™¨) */}
      {image.variants?.webp && (
        <source
          srcSet={image.variants.webp}
          type="image/webp"
        />
      )}

      {/* å“åº”å¼JPEG/PNG */}
      <source
        srcSet={getImageSrcSet(image)}
        sizes="(max-width: 640px) 400px,
               (max-width: 1024px) 800px,
               1200px"
      />

      {/* å›é€€å›¾ç‰‡ */}
      <img
        src={getOptimizedImageUrl(image, 'medium')}
        alt={altText}
        className={className}
        loading="lazy"
      />
    </picture>
  )
}
```

#### ç¤ºä¾‹4: äº§å“å›¾ç‰‡ç”»å»Š

```tsx
// components/product/ProductGallery.tsx
import { useState } from 'react'
import Image from 'next/image'
import { getOptimizedImageUrl, getImageAlt } from '@/lib/image-utils'

interface ProductGalleryProps {
  images: MediaImage[]
  locale: string
}

export function ProductGallery({ images, locale }: ProductGalleryProps) {
  const [selectedIndex, setSelectedIndex] = useState(0)
  const selectedImage = images[selectedIndex]

  return (
    <div className="product-gallery">
      {/* ä¸»å›¾ - ä½¿ç”¨largeå°ºå¯¸ */}
      <div className="main-image mb-4">
        <Image
          src={getOptimizedImageUrl(selectedImage, 'large', true)}
          alt={getImageAlt(selectedImage.altText, locale)}
          width={1200}
          height={1200}
          className="w-full h-auto rounded-lg"
          priority={selectedIndex === 0}  // é¦–å¼ å›¾ç‰‡ä¼˜å…ˆåŠ è½½
        />
      </div>

      {/* ç¼©ç•¥å›¾ - ä½¿ç”¨thumbnailå°ºå¯¸ */}
      <div className="thumbnails flex gap-2 overflow-x-auto">
        {images.map((image, index) => (
          <button
            key={image.id}
            onClick={() => setSelectedIndex(index)}
            className={`
              w-20 h-20 flex-shrink-0 rounded border-2
              ${index === selectedIndex ? 'border-blue-500' : 'border-gray-300'}
            `}
          >
            <Image
              src={getOptimizedImageUrl(image, 'thumbnail', true)}
              alt={getImageAlt(image.altText, locale)}
              width={150}
              height={150}
              className="w-full h-full object-cover rounded"
            />
          </button>
        ))}
      </div>
    </div>
  )
}
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. æ ¹æ®åœºæ™¯é€‰æ‹©å°ºå¯¸

```typescript
// âœ… æ­£ç¡®: æ ¹æ®æ˜¾ç¤ºå°ºå¯¸é€‰æ‹©å˜ä½“
<Image src={getOptimizedImageUrl(image, 'small')} />  // åˆ—è¡¨å¡ç‰‡
<Image src={getOptimizedImageUrl(image, 'large')} />  // è¯¦æƒ…é¡µå¤§å›¾

// âŒ é”™è¯¯: å§‹ç»ˆä½¿ç”¨åŸå›¾
<Image src={image.file.url} />  // æ–‡ä»¶è¿‡å¤§,åŠ è½½æ…¢
```

#### 2. WebPæ ¼å¼ä¼˜å…ˆ

```typescript
// âœ… é»˜è®¤å¯ç”¨WebP
getOptimizedImageUrl(image, 'medium', true)

// ä»…åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ç¦ç”¨(å¦‚éœ€è¦é€æ˜èƒŒæ™¯PNG)
getOptimizedImageUrl(image, 'medium', false)
```

#### 3. å›¾ç‰‡æ‡’åŠ è½½

```tsx
// é¦–å±å›¾ç‰‡ - ç«‹å³åŠ è½½
<Image src={url} alt={alt} priority />

// éé¦–å±å›¾ç‰‡ - æ‡’åŠ è½½ (é»˜è®¤è¡Œä¸º)
<Image src={url} alt={alt} loading="lazy" />
```

#### 4. å ä½å›¾å¤„ç†

```tsx
// ä½¿ç”¨Next.jsçš„blurå ä½
<Image
  src={url}
  alt={alt}
  placeholder="blur"
  blurDataURL="data:image/jpeg;base64,..."  // ç”Ÿæˆçš„base64
/>

// æˆ–ä½¿ç”¨è‡ªå®šä¹‰å ä½å›¾
<Image
  src={url}
  alt={alt}
  onError={(e) => {
    e.currentTarget.src = '/images/placeholder.jpg'
  }}
/>
```

---

## å¤šè¯­è¨€å®ç°

### 1. å¤šè¯­è¨€å†…å®¹æå–å·¥å…·

```typescript
// lib/localization.ts

/**
 * ä»JSONå¤šè¯­è¨€å­—æ®µä¸­æå–æŒ‡å®šè¯­è¨€çš„å†…å®¹
 *
 * @param field - å¤šè¯­è¨€JSONå¯¹è±¡
 * @param locale - è¯­è¨€ä»£ç  (å¦‚: 'en', 'zh', 'es')
 * @param fallback - å¤‡ç”¨æ–‡æœ¬
 * @returns æœ¬åœ°åŒ–åçš„æ–‡æœ¬
 */
export function getLocalizedContent(
  field: Record<string, string> | null | undefined,
  locale: string,
  fallback: string = ''
): string {
  if (!field || typeof field !== 'object') {
    return fallback
  }

  // 1. å°è¯•è·å–æŒ‡å®šè¯­è¨€
  if (field[locale]) {
    return field[locale]
  }

  // 2. å›é€€åˆ°è‹±è¯­
  if (field['en']) {
    return field['en']
  }

  // 3. è¿”å›ç¬¬ä¸€ä¸ªå¯ç”¨çš„å€¼
  const values = Object.values(field)
  if (values.length > 0 && values[0]) {
    return values[0]
  }

  // 4. è¿”å›å¤‡ç”¨æ–‡æœ¬
  return fallback
}

/**
 * æ‰¹é‡æå–å¤šä¸ªå­—æ®µçš„æœ¬åœ°åŒ–å†…å®¹
 *
 * @param obj - åŒ…å«å¤šè¯­è¨€å­—æ®µçš„å¯¹è±¡
 * @param fields - éœ€è¦æå–çš„å­—æ®µåæ•°ç»„
 * @param locale - è¯­è¨€ä»£ç 
 * @returns æœ¬åœ°åŒ–åçš„å¯¹è±¡
 */
export function getLocalizedObject<T extends Record<string, any>>(
  obj: T,
  fields: Array<keyof T>,
  locale: string
): Record<string, string> {
  const result: Record<string, string> = {}

  fields.forEach((field) => {
    const key = String(field)
    result[key] = getLocalizedContent(obj[field], locale)
  })

  return result
}

// ä½¿ç”¨ç¤ºä¾‹
const localized = getLocalizedObject(
  product,
  ['name', 'description', 'shortDescription'],
  locale
)
// è¿”å›: { name: "...", description: "...", shortDescription: "..." }
```

### 2. å¤šè¯­è¨€è·¯ç”±é…ç½®

```typescript
// middleware.ts
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

// æ”¯æŒçš„è¯­è¨€åˆ—è¡¨
const locales = [
  'en', 'zh', 'es', 'fr', 'de', 'ja', 'ko', 'ar', 'ru', 'pt',
  'it', 'nl', 'pl', 'tr', 'vi', 'th', 'id', 'ms', 'hi', 'bn',
  'ur', 'fa', 'uk', 'ro'
]

const defaultLocale = 'en'

export function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname

  // æ£€æŸ¥è·¯å¾„æ˜¯å¦å·²åŒ…å«è¯­è¨€ä»£ç 
  const pathnameHasLocale = locales.some(
    (locale) => pathname.startsWith(`/${locale}/`) || pathname === `/${locale}`
  )

  if (pathnameHasLocale) {
    return NextResponse.next()
  }

  // è¯­è¨€æ£€æµ‹ä¼˜å…ˆçº§
  let locale = defaultLocale

  // 1. Cookie
  const localeCookie = request.cookies.get('NEXT_LOCALE')?.value
  if (localeCookie && locales.includes(localeCookie)) {
    locale = localeCookie
  } else {
    // 2. Accept-Languageå¤´
    const acceptLanguage = request.headers.get('accept-language')
    if (acceptLanguage) {
      const preferred = acceptLanguage.split(',')[0].split('-')[0]
      if (locales.includes(preferred)) {
        locale = preferred
      }
    }
  }

  // é‡å®šå‘åˆ°è¯­è¨€è·¯å¾„
  const url = request.nextUrl.clone()
  url.pathname = `/${locale}${pathname}`
  return NextResponse.redirect(url)
}

export const config = {
  matcher: [
    // æ’é™¤é™æ€æ–‡ä»¶å’ŒAPIè·¯ç”±
    '/((?!api|_next/static|_next/image|favicon.ico|images|icons).*)'
  ]
}
```

### 3. è¯­è¨€åˆ‡æ¢ç»„ä»¶

```tsx
// components/layout/LanguageSwitcher.tsx
'use client'

import { usePathname, useRouter } from 'next/navigation'
import { useLocale } from 'next-intl'

const languages = [
  { code: 'en', name: 'English' },
  { code: 'zh', name: 'ä¸­æ–‡' },
  { code: 'es', name: 'EspaÃ±ol' },
  { code: 'fr', name: 'FranÃ§ais' },
  // ... å…¶ä»–è¯­è¨€
]

export function LanguageSwitcher() {
  const locale = useLocale()
  const pathname = usePathname()
  const router = useRouter()

  const switchLanguage = (newLocale: string) => {
    // è®¾ç½®cookie
    document.cookie = `NEXT_LOCALE=${newLocale}; path=/; max-age=31536000`

    // æ›¿æ¢URLä¸­çš„è¯­è¨€ä»£ç 
    const segments = pathname.split('/')
    segments[1] = newLocale
    const newPath = segments.join('/')

    router.push(newPath)
  }

  return (
    <select
      value={locale}
      onChange={(e) => switchLanguage(e.target.value)}
      className="px-3 py-2 border rounded-lg"
    >
      {languages.map((lang) => (
        <option key={lang.code} value={lang.code}>
          {lang.name}
        </option>
      ))}
    </select>
  )
}
```

---

## SEOæœ€ä½³å®è·µ

### 1. generateMetadataå‡½æ•°

```typescript
// app/[locale]/product/[slug]/page.tsx
import type { Metadata } from 'next'
import { keystoneClient } from '@/lib/keystone-client'
import { gql } from '@apollo/client'
import { getLocalizedContent } from '@/lib/localization'
import { getOptimizedImageUrl } from '@/lib/image-utils'

interface PageProps {
  params: {
    locale: string
    slug: string
  }
}

// åŠ¨æ€ç”ŸæˆSEOå…ƒæ•°æ®
export async function generateMetadata({ params }: PageProps): Promise<Metadata> {
  const { data } = await keystoneClient.query({
    query: gql`
      query GetProductSeriesSEO($slug: String!) {
        productSeries(where: { slug: { equals: $slug } }) {
          name
          description
          featuredImage {
            file { url }
            variants { large }
          }
          seoTitle
          seoDescription
          seoKeywords
        }
      }
    `,
    variables: { slug: params.slug }
  })

  const series = data?.productSeries

  if (!series) {
    return {
      title: 'Product Not Found',
      description: 'The requested product series could not be found.'
    }
  }

  const name = getLocalizedContent(series.name, params.locale)
  const description = getLocalizedContent(series.description, params.locale)
  const imageUrl = getOptimizedImageUrl(series.featuredImage, 'large')

  return {
    // åŸºç¡€SEO
    title: series.seoTitle || name,
    description: series.seoDescription || description,
    keywords: series.seoKeywords,

    // Open Graph (ç¤¾äº¤åª’ä½“åˆ†äº«)
    openGraph: {
      title: series.seoTitle || name,
      description: series.seoDescription || description,
      images: [
        {
          url: imageUrl,
          width: 1200,
          height: 630,
          alt: name
        }
      ],
      url: `https://busrom.com/${params.locale}/product/${params.slug}`,
      type: 'website',
      siteName: 'Busrom',
    },

    // Twitter Card
    twitter: {
      card: 'summary_large_image',
      title: series.seoTitle || name,
      description: series.seoDescription || description,
      images: [imageUrl],
    },

    // å¤šè¯­è¨€å¤‡é€‰é“¾æ¥
    alternates: {
      canonical: `https://busrom.com/${params.locale}/product/${params.slug}`,
      languages: {
        'en': `/en/product/${params.slug}`,
        'zh': `/zh/product/${params.slug}`,
        'es': `/es/product/${params.slug}`,
        'fr': `/fr/product/${params.slug}`,
        // ... å…¶ä»–24ç§è¯­è¨€
      }
    },

    // Robots
    robots: {
      index: true,
      follow: true,
      googleBot: {
        index: true,
        follow: true,
        'max-image-preview': 'large',
        'max-snippet': -1,
      }
    }
  }
}
```

### 2. ç»“æ„åŒ–æ•°æ®(Structured Data)

```tsx
// components/seo/ProductSchema.tsx

interface ProductSchemaProps {
  product: {
    sku: string
    name: string
    description: string
    price?: number
    images: MediaImage[]
  }
  locale: string
}

export function ProductSchema({ product, locale }: ProductSchemaProps) {
  const name = getLocalizedContent(product.name, locale)
  const description = getLocalizedContent(product.description, locale)
  const imageUrl = getOptimizedImageUrl(product.images[0], 'large')

  const schema = {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": name,
    "description": description,
    "sku": product.sku,
    "image": imageUrl,
    "brand": {
      "@type": "Brand",
      "name": "Busrom"
    },
    ...(product.price && {
      "offers": {
        "@type": "Offer",
        "priceCurrency": "USD",
        "price": product.price,
        "availability": "https://schema.org/InStock",
        "url": `https://busrom.com/shop/${product.sku}`
      }
    })
  }

  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(schema) }}
    />
  )
}

// åœ¨é¡µé¢ä¸­ä½¿ç”¨
export default function ProductPage({ product, locale }) {
  return (
    <>
      <ProductSchema product={product} locale={locale} />
      {/* é¡µé¢å†…å®¹ */}
    </>
  )
}
```

### 3. Sitemapç”Ÿæˆ

```typescript
// app/sitemap.xml/route.ts
import { getAllSitemapUrls, generateSitemapXML } from '@/lib/api/sitemap'

export async function GET() {
  const urls = await getAllSitemapUrls()
  const xml = generateSitemapXML(urls, 'https://busrom.com')

  return new Response(xml, {
    headers: {
      'Content-Type': 'application/xml; charset=utf-8',
      'Cache-Control': 'public, max-age=86400, s-maxage=86400',
    }
  })
}
```

### 4. Robots.txt

```typescript
// app/robots.txt/route.ts
export async function GET() {
  const robotsTxt = `User-agent: *
Allow: /

# Sitemaps
Sitemap: https://busrom.com/sitemap.xml

# ç¦æ­¢æŠ“å–
Disallow: /api/
Disallow: /_next/
Disallow: /admin/
`

  return new Response(robotsTxt, {
    headers: {
      'Content-Type': 'text/plain; charset=utf-8',
      'Cache-Control': 'public, max-age=86400',
    }
  })
}
```

---

## åç«¯æ¨¡å‹æ³¨æ„äº‹é¡¹

### 1. NavigationMenu (å¯¼èˆªèœå•)

**é‡è¦ç‰¹æ€§**:
- æ”¯æŒå¤šå±‚çº§(parent/children)
- ä¸‰ç§ç±»å‹: STANDARD, PRODUCT_CARDS, SUBMENU
- `randomImage`å­—æ®µ: æ ¹æ®`mediaTags`è‡ªåŠ¨è·å–éšæœºå›¾ç‰‡

**å‰ç«¯æ³¨æ„äº‹é¡¹**:

```typescript
// âš ï¸ randomImageæ˜¯è™šæ‹Ÿå­—æ®µ,æ¯æ¬¡æŸ¥è¯¢å¯èƒ½è¿”å›ä¸åŒå›¾ç‰‡
// å»ºè®®: åœ¨å®¢æˆ·ç«¯ç¼“å­˜æˆ–ä½¿ç”¨å›ºå®šçš„mediaTagsæŸ¥è¯¢

// âœ… æ­£ç¡®åšæ³•
query GetNavigation {
  navigationMenus {
    slug
    name
    type
    children {
      slug
      name
      mediaTags {
        id
      }
      randomImage {
        url
        variants { medium }
      }
    }
  }
}

// ç„¶ååœ¨å‰ç«¯:
const imageUrl = child.randomImage
  ? getOptimizedImageUrl(child.randomImage, 'medium')
  : '/images/placeholder.jpg'
```

### 2. Media (åª’ä½“åº“)

**é‡è¦å­—æ®µ**:
- `variants`: åŒ…å«6ç§å°ºå¯¸çš„ä¼˜åŒ–å›¾ç‰‡URL
- `altText`: 24è¯­è¨€çš„altæ–‡æœ¬(JSONæ ¼å¼)
- `status`: ACTIVE/ARCHIVED (è½¯åˆ é™¤)

**å‰ç«¯æ³¨æ„äº‹é¡¹**:

```typescript
// âš ï¸ å§‹ç»ˆæ£€æŸ¥statuså­—æ®µ
query GetMedia {
  media(where: { status: { equals: "ACTIVE" } }) {
    file { url }
    variants { medium webp }
    altText
  }
}

// âš ï¸ variantså¯èƒ½ä¸ºç©º(å¦‚æœå›¾ç‰‡æœªå¤„ç†)
const imageUrl = image.variants?.medium || image.file.url
```

### 3. ProductSeries / Product (äº§å“)

**é‡è¦å­—æ®µ**:
- `name`, `description`: JSONå¤šè¯­è¨€
- `contentTranslations`: å…³è”è¡¨,å­˜å‚¨å¯Œæ–‡æœ¬å†…å®¹
- `status`: DRAFT/PUBLISHED (åªæ˜¾ç¤ºPUBLISHED)

**å‰ç«¯æ³¨æ„äº‹é¡¹**:

```typescript
// âš ï¸ å§‹ç»ˆç­›é€‰PUBLISHEDçŠ¶æ€
query GetProducts {
  products(where: { status: { equals: "PUBLISHED" } }) {
    sku
    name
  }
}

// âš ï¸ contentTranslationsæ˜¯å…³è”è¡¨,éœ€è¦æŒ‰localeæŸ¥è¯¢
contentTranslations(where: { locale: { equals: $locale } }) {
  content  // Document Editor JSONæ ¼å¼
}

// ä½¿ç”¨Keystoneçš„DocumentRendereræ¸²æŸ“
import { DocumentRenderer } from '@keystone-6/document-renderer'

<DocumentRenderer document={contentTranslation.content} />
```

### 4. Blog / Application (å†…å®¹ç±»å‹)

**é‡è¦å­—æ®µ**:
- `publishedAt`: å‘å¸ƒæ—¶é—´
- `readingTime`: é˜…è¯»æ—¶é•¿(åˆ†é’Ÿ)
- `viewCount`: æµè§ˆæ¬¡æ•°

**å‰ç«¯æ³¨æ„äº‹é¡¹**:

```typescript
// âš ï¸ æŒ‰å‘å¸ƒæ—¶é—´å€’åºæ’åˆ—
query GetBlogs {
  blogs(
    where: { status: { equals: "PUBLISHED" } }
    orderBy: { publishedAt: desc }
  ) {
    slug
    title
    publishedAt
  }
}

// âš ï¸ readingTimeå¯èƒ½ä¸ºnull,éœ€è¦å¤„ç†
const readTime = blog.readingTime || 5  // é»˜è®¤5åˆ†é’Ÿ
```

### 5. ContactForm (è¡¨å•)

**é‡è¦å­—æ®µ**:
- `source`: website/landing_page/email
- `locale`: ç”¨æˆ·æäº¤æ—¶çš„è¯­è¨€
- `status`: NEW/PENDING/COMPLETED

**å‰ç«¯æ³¨æ„äº‹é¡¹**:

```typescript
// âš ï¸ æäº¤æ—¶éœ€è¦åŒ…å«locale
mutation SubmitContactForm($data: ContactFormCreateInput!) {
  createContactForm(data: $data) {
    id
  }
}

// Variables
{
  "data": {
    "name": "å¼ ä¸‰",
    "email": "zhang@example.com",
    "message": "...",
    "source": "website",
    "locale": "zh"  // âš ï¸ å¿…å¡«
  }
}
```

### 6. SEOç›¸å…³æ¨¡å‹

**SeoSetting**:
- é¡µé¢çº§SEOé…ç½®
- æŒ‰`page`å’Œ`locale`æŸ¥è¯¢

**SiteConfig**:
- ç«™ç‚¹çº§é…ç½®(Singleton)
- åŒ…å«è”ç³»ä¿¡æ¯ã€ç¤¾äº¤åª’ä½“ç­‰

**å‰ç«¯æ³¨æ„äº‹é¡¹**:

```typescript
// âš ï¸ SiteConfigæ˜¯å•ä¾‹,åªæœ‰ä¸€æ¡è®°å½•
query GetSiteConfig {
  siteConfigs(take: 1) {
    siteName
    contactEmail
  }
}

// âš ï¸ SeoSettingæŒ‰é¡µé¢æŸ¥è¯¢
query GetSEO($page: String, $locale: String) {
  seoSettings(
    where: {
      page: { equals: $page }
      locale: { equals: $locale }
    }
    take: 1
  ) {
    title
    description
  }
}
```

---

## å¼€å‘è§„èŒƒ

### 1. Tailwind CSSä½¿ç”¨è§„èŒƒ

#### âœ… æ­£ç¡®åšæ³•

```tsx
// âœ… ä½¿ç”¨TailwindåŸå­ç±»
<div className="flex items-center justify-between px-4 py-2 bg-white shadow-md rounded-lg">
  <h1 className="text-2xl font-bold text-gray-900">Title</h1>
  <button className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
    Click Me
  </button>
</div>

// âœ… å“åº”å¼è®¾è®¡
<div className="
  w-full              // ç§»åŠ¨ç«¯: å…¨å®½
  md:w-1/2            // å¹³æ¿: 50%
  lg:w-1/3            // æ¡Œé¢: 33.33%
  px-4 md:px-6 lg:px-8  // å“åº”å¼å†…è¾¹è·
">
  Content
</div>

// âœ… ä½¿ç”¨@applyæå–é‡å¤æ ·å¼
// styles/globals.css
@layer components {
  .btn-primary {
    @apply px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors;
  }
}
```

#### âŒ é”™è¯¯åšæ³•

```tsx
// âŒ ç¦æ­¢ä½¿ç”¨inline styles
<div style={{ display: 'flex', padding: '16px' }}>  // ä¸è¦è¿™æ ·!

// âŒ ç¦æ­¢è‡ªå®šä¹‰CSSç±»(é™¤éä½¿ç”¨@apply)
<div className="my-custom-header">  // ä¸è¦è¿™æ ·!

// âŒ ç¦æ­¢ä½¿ç”¨å…¶ä»–CSSæ¡†æ¶
<div className="container-fluid">  // Bootstrap,ä¸è¦!
```

### 2. TypeScriptç±»å‹å®šä¹‰

```typescript
// types/models.ts

/**
 * å¤šè¯­è¨€JSONå­—æ®µç±»å‹
 */
export type MultilingualField = Record<string, string> | null

/**
 * å›¾ç‰‡å˜ä½“ç±»å‹
 */
export interface ImageVariants {
  thumbnail?: string
  small?: string
  medium?: string
  large?: string
  xlarge?: string
  webp?: string
}

/**
 * Mediaå›¾ç‰‡ç±»å‹
 */
export interface MediaImage {
  id: string
  filename: string
  file: {
    url: string
    width?: number
    height?: number
  }
  variants?: ImageVariants
  altText?: MultilingualField
}

/**
 * äº§å“ç³»åˆ—ç±»å‹
 */
export interface ProductSeries {
  id: string
  slug: string
  name: MultilingualField
  description: MultilingualField
  featuredImage: MediaImage | null
  status: 'DRAFT' | 'PUBLISHED'
  order: number
}

/**
 * äº§å“ç±»å‹
 */
export interface Product {
  id: string
  sku: string
  slug: string
  name: MultilingualField
  shortDescription: MultilingualField
  description: MultilingualField
  images: MediaImage[]
  price?: number
  compareAtPrice?: number
  inStock: boolean
  status: 'DRAFT' | 'PUBLISHED'
}
```

### 3. é”™è¯¯è¾¹ç•Œ

```tsx
// components/ErrorBoundary.tsx
'use client'

import { Component, ReactNode } from 'react'

interface Props {
  children: ReactNode
  fallback?: ReactNode
}

interface State {
  hasError: boolean
  error?: Error
}

export class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props)
    this.state = { hasError: false }
  }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error }
  }

  componentDidCatch(error: Error, errorInfo: any) {
    console.error('Error caught by boundary:', error, errorInfo)
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || (
        <div className="min-h-screen flex items-center justify-center">
          <div className="text-center">
            <h2 className="text-2xl font-bold text-red-600 mb-4">
              å‡ºé”™äº†
            </h2>
            <p className="text-gray-600 mb-4">
              {this.state.error?.message || 'é¡µé¢åŠ è½½å¤±è´¥'}
            </p>
            <button
              onClick={() => window.location.reload()}
              className="btn-primary"
            >
              åˆ·æ–°é¡µé¢
            </button>
          </div>
        </div>
      )
    }

    return this.props.children
  }
}
```

### 4. æ€§èƒ½ä¼˜åŒ–

```tsx
// âœ… ä½¿ç”¨åŠ¨æ€å¯¼å…¥æ‡’åŠ è½½éé¦–å±ç»„ä»¶
import dynamic from 'next/dynamic'

const HeavyComponent = dynamic(() => import('./HeavyComponent'), {
  loading: () => <Spinner />,
  ssr: false  // ä»…å®¢æˆ·ç«¯æ¸²æŸ“
})

// âœ… ä½¿ç”¨React.memoé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
import { memo } from 'react'

export const ProductCard = memo(function ProductCard({ product }) {
  return <div>{product.name}</div>
})

// âœ… ä½¿ç”¨useMemoç¼“å­˜è®¡ç®—ç»“æœ
import { useMemo } from 'react'

const filteredProducts = useMemo(() => {
  return products.filter(p => p.inStock)
}, [products])

// âœ… ä½¿ç”¨ISR(Incremental Static Regeneration)
export const revalidate = 3600  // 1å°æ—¶é‡æ–°éªŒè¯
```

---

## å¸¸è§é—®é¢˜FAQ

### Q1: å›¾ç‰‡åŠ è½½å¤±è´¥æ€ä¹ˆåŠ?

```tsx
<Image
  src={imageUrl}
  alt={altText}
  onError={(e) => {
    e.currentTarget.src = '/images/placeholder.jpg'
  }}
/>
```

### Q2: å¤šè¯­è¨€å†…å®¹ä¸ºç©ºæ€ä¹ˆå¤„ç†?

```typescript
const name = getLocalizedContent(product.name, locale, 'æœªå‘½åäº§å“')
//                                                    ^^^^^^ æä¾›é»˜è®¤å€¼
```

### Q3: GraphQLæŸ¥è¯¢è¿”å›nullæ€ä¹ˆåŠ?

```typescript
const { data, errors } = await keystoneClient.query({ query })

if (errors) {
  // å¤„ç†é”™è¯¯
  return <ErrorPage />
}

if (!data || !data.products) {
  // æ•°æ®ä¸ºç©º
  return <EmptyState message="æš‚æ— äº§å“" />
}
```

### Q4: å¦‚ä½•å¤„ç†Document Editorçš„å¯Œæ–‡æœ¬?

```tsx
import { DocumentRenderer } from '@keystone-6/document-renderer'

// 1. æŸ¥è¯¢contentTranslations
const content = product.contentTranslations.find(t => t.locale === locale)

// 2. æ¸²æŸ“
{content && (
  <DocumentRenderer document={content.content} />
)}
```

### Q5: å¦‚ä½•å®ç°äº§å“åˆ—è¡¨åˆ†é¡µ?

```typescript
const [page, setPage] = useState(1)
const pageSize = 12

const { data } = await keystoneClient.query({
  query: GET_PRODUCTS,
  variables: {
    take: pageSize,
    skip: (page - 1) * pageSize
  }
})

const totalPages = Math.ceil(data.productsCount / pageSize)
```

### Q6: å¦‚ä½•ä¼˜åŒ–é¦–å±åŠ è½½é€Ÿåº¦?

1. ä½¿ç”¨`priority`å±æ€§åŠ è½½é¦–å±å›¾ç‰‡
2. ä½¿ç”¨ISRç¼“å­˜é™æ€å†…å®¹
3. æ‡’åŠ è½½éé¦–å±ç»„ä»¶
4. ä½¿ç”¨WebPæ ¼å¼å›¾ç‰‡
5. å¯ç”¨Gzip/Brotliå‹ç¼©

### Q7: Navigation Menuçš„randomImageä¸ç¨³å®š?

```typescript
// randomImageæ˜¯è™šæ‹Ÿå­—æ®µ,æ¯æ¬¡æŸ¥è¯¢å¯èƒ½ä¸åŒ
// è§£å†³æ–¹æ¡ˆ1: å®¢æˆ·ç«¯ç¼“å­˜
const [navImages, setNavImages] = useState<Record<string, string>>({})

useEffect(() => {
  // é¦–æ¬¡åŠ è½½æ—¶ç¼“å­˜å›¾ç‰‡URL
  const images: Record<string, string> = {}
  navigation.forEach(item => {
    if (item.randomImage) {
      images[item.id] = item.randomImage.url
    }
  })
  setNavImages(images)
}, [])

// è§£å†³æ–¹æ¡ˆ2: ä½¿ç”¨å›ºå®šçš„featuredImageå­—æ®µ(å»ºè®®åç«¯æ·»åŠ )
```

---

## å¼€å‘æ£€æŸ¥æ¸…å•

### ä»£ç è´¨é‡

- [ ] æ‰€æœ‰ç»„ä»¶éƒ½æœ‰TypeScriptç±»å‹å®šä¹‰
- [ ] ä½¿ç”¨Tailwind CSS,æ— è‡ªå®šä¹‰CSSç±»
- [ ] å›¾ç‰‡ä½¿ç”¨variantsä¼˜åŒ–,ä¸ç›´æ¥ä½¿ç”¨åŸå›¾
- [ ] å¤šè¯­è¨€å†…å®¹æ­£ç¡®æå–,æœ‰å›é€€æœºåˆ¶
- [ ] GraphQLæŸ¥è¯¢æœ‰é”™è¯¯å¤„ç†
- [ ] æ•æ„Ÿä¿¡æ¯(API Key)å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡

### SEO

- [ ] æ‰€æœ‰é¡µé¢æœ‰`generateMetadata`å‡½æ•°
- [ ] å›¾ç‰‡æœ‰altå±æ€§
- [ ] ç»“æ„åŒ–æ•°æ®(Schema.org)é…ç½®æ­£ç¡®
- [ ] Sitemap.xmlæ­£å¸¸ç”Ÿæˆ
- [ ] Robots.txté…ç½®æ­£ç¡®
- [ ] å¤šè¯­è¨€hreflangæ ‡ç­¾é…ç½®

### æ€§èƒ½

- [ ] Lighthouse Performance > 90
- [ ] é¦–å±å›¾ç‰‡ä½¿ç”¨`priority`
- [ ] éé¦–å±ç»„ä»¶æ‡’åŠ è½½
- [ ] ä½¿ç”¨WebPæ ¼å¼å›¾ç‰‡
- [ ] å¯ç”¨ISRç¼“å­˜

### å“åº”å¼

- [ ] ç§»åŠ¨ç«¯æµ‹è¯•é€šè¿‡(375px+)
- [ ] å¹³æ¿æµ‹è¯•é€šè¿‡(768px+)
- [ ] æ¡Œé¢ç«¯æµ‹è¯•é€šè¿‡(1440px+)
- [ ] è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ

### å¤šè¯­è¨€

- [ ] 24ç§è¯­è¨€åˆ‡æ¢æ­£å¸¸
- [ ] URLåŒ…å«è¯­è¨€ä»£ç 
- [ ] Cookieè®°ä½ç”¨æˆ·è¯­è¨€åå¥½
- [ ] æ‰€æœ‰æ–‡æœ¬æ”¯æŒå¤šè¯­è¨€

---

## ç›¸å…³æ–‡æ¡£

- [GraphQL APIå®Œæ•´æ–‡æ¡£](./GraphQL_APIå®Œæ•´æ–‡æ¡£.md) - åç«¯APIæ¥å£è¯¦ç»†è¯´æ˜
- [GraphQLæŸ¥è¯¢ç¤ºä¾‹é›†åˆ](./GraphQLæŸ¥è¯¢ç¤ºä¾‹é›†åˆ.graphql) - å¯ç›´æ¥ä½¿ç”¨çš„æŸ¥è¯¢
- [APIç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆ](./APIç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆ.md) - APIç‰ˆæœ¬ç®¡ç†

---

**æ–‡æ¡£ç»´æŠ¤**: å‰ç«¯å¼€å‘å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-11-06
**ç‰ˆæœ¬**: v2.0

å¦‚æœ‰ç–‘é—®,è¯·è”ç³»æŠ€æœ¯å›¢é˜Ÿã€‚
